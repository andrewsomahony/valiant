<!DOCTYPE HTML>
<html>
   
<head>
   <title>Embedding HTML5 Video Test</title>
   
   <style type="text/css">
      html, body {
         width: 100%;
         height: 100%;
      }
      
      img, iframe, video {
         vertical-align: middle;
      }
      
      .centered {
         display: inline-block;
         
         position: absolute;
         margin: auto;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;         
      }
      
      div.media-container {
         border: 1px solid black;
         width: 300px;
         height: 300px;
         display: inline-block;
         vertical-align: top;
         position: relative;
         margin-right: 8px;
         margin-bottom: 8px;
      }
      
      div.video-container .video-fitted {
         width: 100%;
         height: 70%;
         
         display: inline-block;
         position: relative;
         vertical-align: top;
      }
      
      /* Make this one into the Angular directive for Valiant*/
      div.video-fitted video {
         width: 95%;
         height: auto;
         
         max-width: 100%;
         max-height: 100%;         
      }
      
      div.video-container .video {
         width: 250px;
         height: auto;
         
         display: inline-block;
      }
      
      div.video video {
         width: 100%;
         height: 100%;
      }
      
      /*
         We have to manage the aspect ratio ourselves here
         About 1.809
      */      
      
      div.youtube-container .youtube-video {
         width: 100%;
         height: 55.2%;
         
         display: inline-block;
      }
      
      div.youtube-video iframe {
         width: 100%;
         height: 100%;
      }
      
      div.youtube-container .youtube-video-fitted {
         width: 100%;
         height: 70%;
         
         display: inline-block; 
         position: relative;
         vertical-align: top;
      }
      
      /*
         We have to manage the aspect ratio ourselves here
         About 1.809
      */
      div.youtube-video-fitted iframe {
         width: 95%;
         height: 75%;
      }
      
      div.image-container {
         text-align: center;
      }
      
      div.image-container div.image-button {
         text-align: center;
      }
      
      div.image-container div.image-fitted {
         width: 90%;
         height: 60%;
         
         margin-top: 10px;
         
         display: inline-block;
         position: relative;
         vertical-align: top;
      }
      
      div.image-fitted img {
         width: auto;
         height: 100%;
         
         max-width: 100%;
         max-height: 100%;
      }      
      
      div.image {
         width: 200px;
         height: auto;
         
         position: absolute;
         left: 18px;
         top: 100px;
         
         display: inline-block;
      }
      
      div.image img {
         width: 100%;
         height: 100%;
      }
   </style>
   
   <script type="text/javascript">
      var possibleImages = ['./test1.jpg', './test2.jpg', './test3.jpg'];
   
      function getEventTarget(event) {
         return event.target;
      }
   
      function switchImage(button) {
         var image = button.parentNode.parentNode.querySelectorAll('img')[0];
         
         var rootSrc = "./" + image.src.split('://')[1].split('/')[1];
         var currentIndex = possibleImages.indexOf(rootSrc);
         if (possibleImages.length - 1 === currentIndex) {
            currentIndex = 0;
         } else {
            currentIndex += 1;
         }
         
         image.src = possibleImages[currentIndex];
      }
      
      function addVideo(button) {
         var div = button.parentNode.parentNode.querySelectorAll("div[video-display]");
         
         var existingVideoElement = div[0].querySelectorAll('video');
         if (existingVideoElement) {
            div[0].removeChild(existingVideoElement[0]);
         }
         
         var videoElement = document.createElement('video');
         
         videoElement.setAttribute('controls', '');
         videoElement.setAttribute('preload', 'metadata');
         videoElement.src = "./soccer_small.m4v";
         
         videoElement.addEventListener('loadstart', function(event) {
            console.log("VIDEO LOAD START", event);
         });
         
         videoElement.addEventListener('loadedmetadata', function(event) {
            console.log("VIDEO METADATA LOADED", event);
         });
         
         videoElement.addEventListener('progress', function(event) {
            console.log("VIDEO LOAD PROGRESS", event);
            var target = getEventTarget(event);
            
            var buffered = target.buffered;
            
            if (buffered.length) {
               console.log(buffered.start(0), buffered.end(0));
            }
         });
         
         videoElement.addEventListener('timeupdate', function(event) {
            console.log("TIME UPDATE", event);
         });
         
         videoElement.addEventListener('seeking', function(event) {
            console.log("SEEKING", event);
         });
         
         videoElement.addEventListener('seeked', function(event) {
            console.log("SEEKED", event);
         });
         
         videoElement.addEventListener('pause', function(event) {
            console.log("VIDEO PAUSED", event);
         });
         
         div[0].appendChild(videoElement);
      }
      
      function doVideo(button) {
         var video = button.parentNode.parentNode.querySelectorAll("video")[0];
         
         console.log(button.parentNode.parentNode.querySelectorAll("video"));
         video.currentTime = 3;
      } 
      
      function addSubtitles(button) {
         var video = button.parentNode.parentNode.querySelectorAll("video")[0];
         
         var track = document.createElement('track');
         
         track.src = './subtitles.vtt';
         track.setAttribute('kind', 'subtitles');
         track.setAttribute('srclang', 'en');
         track.setAttribute('label', 'English');
         track.setAttribute('default', '');
         
         video.appendChild(track);
      }
      
      function loadSubtitles(input) {
         var file = input.files[0];
         
         var fileReader = new FileReader();
         
         fileReader.onload = function(event) {
            var arrayBuffer = event.target.result;
            
            var blob = new Blob([arrayBuffer], 
                  {type: "text/vtt"})            
            
            var urlCreator = window.URL || window.webkitURL;     
         
            var url = urlCreator.createObjectURL(blob);

            var video = input.parentNode.parentNode.querySelectorAll("video")[0];
            
            var track = document.createElement('track');
            
            track.src = url;
            track.setAttribute('kind', 'subtitles');
            track.setAttribute('srclang', 'en');
            track.setAttribute('label', 'English');
            track.setAttribute('default', '');
            
            video.appendChild(track);            
         }
         
         fileReader.readAsArrayBuffer(file);
      }
      
   </script>
   
</head>

<body>
   <div class="video-container media-container">
      <div video-display class="video-fitted" centered="true" fitted="true" width="95%">
         <video controls src="./soccer_small.m4v" class="centered" preload="metadata">
         </video>
      </div>
      <div class="video-button">
         <button onclick="addVideo(this)">Add Video</button>
         <button onclick="doVideo(this)">Do Video</button>
         <button onclick="addSubtitles(this)">Add Subtitles</button>
         <input type="file" onchange="loadSubtitles(this)" accept="text/vtt" />
      </div>
   </div>
   
   <div class="video-container media-container">
      <div video-display class="video" width="250px">
         <video controls src="./soccer_small.m4v"">
         </video>
      </div>
      <div class="video-button">
         <button onclick="doVideo(this)">Do Video</button>
         <button onclick="addSubtitles(this)">Add Subtitles</button>
         <input type="file" onchange="loadSubtitles(this)" accept="text/vtt" />
      </div>
   </div>   
   
   <div class="youtube-container media-container">
      <div youtube-display class="youtube-video-fitted" centered="true" fitted="true" width="95%">
         <iframe
            src="http://www.youtube.com/embed/PekRc5Ufp10?fs=1&playinline=0&modestbranding=1"
            class="centered">
         </iframe>
      </div>
   </div>
   
   <div class="youtube-container media-container">
      <div youtube-display class="youtube-video" width="100%">
         <iframe
            src="http://www.youtube.com/embed/PekRc5Ufp10?fs=1&playinline=0&modestbranding=1">
         </iframe>
      </div>
   </div>   
   
   <!-- 
      
      A fitted picture display scales the image based on which dimension
      is greater, then places it just within the parent element, with an optional
      parameter for centering it.
      
      A dynamic picture display just makes a div, gives it a static width, and lets
      the browser handle the height resizing.  Good for inline and such.
      
   -->
   
   <div class="image-container media-container">
      <div media-type="picture" model="user.profilePicture" fitted="true" centered="true" class="image-fitted">
         <!-- This is inserted by the directive -->
         <img src="./test3.jpg" class="centered" />
      </div>
      <div class="image-button">
         <button onclick="switchImage(this)">Switch Image</button>
      </div>
   </div>
   
   <div class="image-container media-container">
      <!-- The directive will set width and height to a dimension or auto on the root element -->
      <div media-type="picture" model="user.profilePicture" width="200px" class="image">
         <!-- This is inserted by the directive -->
         <img src="./test2.jpg" />
      </div>
      <div class="image-button">
         <button onclick="switchImage(this)">Switch Image</button>
      </div>      
   </div>
</body>

</html>