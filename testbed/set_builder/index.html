<!DOCTYPE HTML>
<html>
   
<head>
   <title>Swim Set Builder</title>

   <script src="./utils.js" type="text/javascript"></script>
   <script src="./ready.js" type="text/javascript"></script>
   <script src="./uuid.js" type="text/javascript"></script>

   <link rel="stylesheet" href="./bootstrap.css" type="text/css"></script>
   
   <style type="text/css">
      html, body {
         width: 100%;
         height: 100%;
      }

      div.container {
         width: 100%;
         padding: 0;
         margin: 0;
      }

      div.menu {
         border-bottom: 1px solid black;
         height: 50px;
      }

      input {
         font-size: 14px;
         font-weight: normal;
         color: black;
      }

      a {
         text-decoration: underline;
         cursor: pointer;
      }

      div.set-display, div.set-gauge {
         padding-left: 64px;
         padding-top: 64px;
      }

      div.set-display-text {
         margin-bottom: 30px;
      }

      div.set-element {
         font-size: 20px;
         color: black;
         margin-bottom: 4px;
      }

      div.set-element span {
         margin-right: 6px;
      }

      div.set-element span.notes {
         font-size: 16px;
      }

      div.set-element a {
         font-size: 16px;
         margin-left: 12px;
      }
      
      div.set-element.edit {

      }

      div.set-total-distance {
         font-size: 22px;
         margin-top: 16px;
         border-top: 1px solid black;
      }

      div.set-element.edit input {
         width: 25%;
      }

      div.set-element.edit input.set-element-input-notes {
         width: 50%;
      }

      @media print {
         .col-print-12 {
            width: 100%;
         }

         div.set-gauge {
            display: none;
         }
         div.set-display-add {
            display: none;
         }
         div.menu {
            display: none;
         }
         div.set-display-text {
            width: 100%;
            display: block;
         }

         div.set-element {
            font-size: 30px;
         }

         div.set-element span.notes {
            font-size: 25px;
         }

         div.set-total-distance {
            font-size: 32px;
         }

         div.set-element a {
            display: none;
         }
      }
   </style>
   
   <script type="text/javascript">
      'use strict';

      var setModel = {
         elements: [],
         speedGauges: []
      };

      var speedGaugeModel = {
         type: "",
         distance: 0,
         time: 0
      };

      var setElementModel = {
         id: "",
         distance: 0,
         type: "",
         quantity: 1,
         interval: "",
         stroke: "",
         stroke_modification: "",
         notes: ""
      };

      var setElementTypes = ["Swim", "Kick"];

      var setElementStrokeModifications = ["Scull", "Fists", "Drill"];

      var setElementStrokes = ["Butterfly",
                               "Backstroke", 
                               "Breaststroke", 
                               "Freestyle",
                               "IM",
                               "Choice"];

      var currentSet = null;

      var setElementDisplaySelector = ".set-display-text";
      var setTotalDistanceSelector = ".set-total-distance";

      function newSet() {
         return utils.clone(setModel);
      }

      function newSpeedGauge() {
         return utils.clone(speedGauge);
      }

      function newSetElement() {
         return utils.clone(setElementModel);
      }

      function calculateSetTotalDistance(set) {
         var totalDistance = 0;
         set.elements.forEach(function(setElement) {
            totalDistance += setElement.distance * setElement.quantity;
         });

         return totalDistance;
      }

      function makeSetTotalDistanceDOM(set) {
         var div = document.createElement("div");
         div.className += " " + setTotalDistanceSelector.slice(1);

         var span = document.createElement("span");

         span.innerHTML = "Total: " + calculateSetTotalDistance(set);

         div.appendChild(span);

         return div;
      }

      function addSetElementToSet(set, setElement) {
         set.elements.push(setElement);

         var setElementList = document.querySelectorAll(setElementDisplaySelector)[0];

         setElementList.appendChild(makeSetElementDOM(setElement));

         var totalDistanceElement = document.querySelectorAll(setTotalDistanceSelector);

         if (totalDistanceElement.length) {
            setElementList.removeChild(totalDistanceElement[0]);
         }
         setElementList.appendChild(makeSetTotalDistanceDOM(set));
      }

      function removeSetElementFromSet(set, id) {
         var index = null;

         set.elements.forEach(function(setElement, i) {
            if (id === setElement.id) {
               index = i;
            }
         });

         if (null !== index) {
            set.elements.splice(index, 1);
         }

         var setElementList = document.querySelectorAll(setElementDisplaySelector)[0];

         setElementList.removeChild(document.getElementById(id));

         var totalDistanceElement = document.querySelectorAll(setTotalDistanceSelector);

         if (totalDistanceElement.length) {
            setElementList.removeChild(totalDistanceElement[0]);
         }
         setElementList.appendChild(makeSetTotalDistanceDOM(set));
      }

      function makeSetElementDOM(setElement) {
         var parentDiv = document.createElement("div");
         parentDiv.setAttribute("id", setElement.id);
         parentDiv.className += " set-element";

         function makeSetElementSpan(value) {
            var setElementSpan = document.createElement("span");

            setElementSpan.innerHTML = value;

            return setElementSpan;
         }

         parentDiv.appendChild(makeSetElementSpan("" + setElement.quantity + "x" + setElement.distance));
         parentDiv.appendChild(
            makeSetElementSpan("" + setElement.stroke + (setElement.stroke_modification ? " (" + setElement.stroke_modification + ")" : "")));
         parentDiv.appendChild(makeSetElementSpan("" + setElement.type));

         if (setElement.interval) {
            parentDiv.appendChild(makeSetElementSpan("@" + setElement.interval));
         }

         if (setElement.notes) {
            var notesSpan = makeSetElementSpan("(" + setElement.notes + ")");
            notesSpan.className += " notes";

            parentDiv.appendChild(notesSpan);
         }

         var deleteButton = document.createElement("a");
         deleteButton.innerHTML = "Delete";
         deleteButton.onclick = function() {
            removeSetElementFromSet(currentSet, setElement.id);
         }
         parentDiv.appendChild(deleteButton);

         return parentDiv;
      }

      function makeSetElementEditDOM() {
         function createEditDiv(childElement) {
            var div = document.createElement("div");
            div.className += " set-element edit";

            if (childElement) {
               div.appendChild(childElement);
            }

            return div;
         }

         function createEditSelect(options, defaultChoice) {
            var select = document.createElement("select");

            var defaultOption = document.createElement("option");
            defaultOption.setAttribute("value", "");
            defaultOption.innerHTML = defaultChoice;

            select.appendChild(defaultOption);

            options.forEach(function(option) {
               var optionElement = document.createElement("option");
               optionElement.setAttribute("value", option);
               optionElement.innerHTML = option;

               select.appendChild(optionElement);
            });

            return select;
         }

         var parentDiv = document.createElement("div");
         parentDiv.setAttribute('id', uuid.v1());

         var distanceInput = document.createElement("input");
         distanceInput.setAttribute('type', 'text');
         distanceInput.setAttribute('placeholder', 'Distance');
         distanceInput.className += " form-control set-element-input-distance";

         parentDiv.appendChild(createEditDiv(distanceInput));

         var quantityInput = document.createElement("input");
         quantityInput.setAttribute('type', 'text');
         quantityInput.setAttribute('placeholder', 'Quantity');
         quantityInput.className += " form-control set-element-input-quantity";

         parentDiv.appendChild(createEditDiv(quantityInput));

         var strokeInput = createEditSelect(setElementStrokes, "--Select Stroke---");

         parentDiv.appendChild(createEditDiv(strokeInput));

         var strokeModificationInput = createEditSelect(setElementStrokeModifications, "--Select Stroke Modification--");

         parentDiv.appendChild(createEditDiv(strokeModificationInput));

         var typeInput = createEditSelect(setElementTypes, "--Select Type--");

         parentDiv.appendChild(createEditDiv(typeInput));

         var intervalInput = document.createElement("input");
         intervalInput.setAttribute('type', 'text');
         intervalInput.setAttribute('placeholder', 'Interval');
         intervalInput.className += " form-control set-element-input-interval";

         parentDiv.appendChild(createEditDiv(intervalInput));

         var notesInput = document.createElement("input");
         notesInput.setAttribute('type', 'text');
         notesInput.setAttribute('placeholder', 'Notes');
         notesInput.className += " form-control set-element-input-notes";

         parentDiv.appendChild(createEditDiv(notesInput));

         var buttonsDiv = createEditDiv();

         var saveButton = document.createElement("a");
         saveButton.innerHTML = "Save";

         saveButton.onclick = function() {
            var setElement = newSetElement();

            setElement.id = parentDiv.getAttribute("id");
            setElement.distance = parseInt(distanceInput.value);
            setElement.stroke = strokeInput.value;
            setElement.stroke_modification = strokeModificationInput.value;
            setElement.quantity = parseInt(quantityInput.value || 1);
            setElement.interval = intervalInput.value;
            setElement.type = typeInput.value;
            setElement.notes = notesInput.value;

            addSetElementToSet(currentSet, setElement);
            document.querySelectorAll(".add-set-element-button")[0].style.display = "inline";

            parentDiv.parentNode.removeChild(parentDiv);
         }

         var cancelButton = document.createElement("a");
         cancelButton.innerHTML = "Cancel";

         cancelButton.onclick = function() {
            document.querySelectorAll(".add-set-element-button")[0].style.display = "inline";
            parentDiv.parentNode.removeChild(parentDiv);
         }

         buttonsDiv.appendChild(saveButton);
         buttonsDiv.appendChild(cancelButton);

         parentDiv.appendChild(buttonsDiv);

         return parentDiv;
      }

      function showNewSetElement() {
         document.querySelectorAll(".add-set-element-button")[0].style.display = "none";
         document.querySelectorAll(".set-display-edit")[0].appendChild(makeSetElementEditDOM());
      }

      domready(function() {
         currentSet = newSet();
      });
   </script>
   
</head>

<body>
   <div class="container">
      <div class="row">
         <div class="menu col-xs-12 col-sm-12 col-md-12 col-lg-12">
         </div>
         <div class="set-display col-xs-8 col-sm-8 col-md-8 col-lg-8 col-print-12">
            <div class="set-display-text">
            </div>
            <div class="set-display-add">
               <a onclick="showNewSetElement()" class="add-set-element-button" >Add Set Element</a>
               <div class="set-display-edit">
               </div>
            </div>
         </div>
         <div class="set-gauge col-xs-4 col-sm-4 col-md-4 col-lg-4">

         </div>
      </div>
   </div>
</body>

</html>